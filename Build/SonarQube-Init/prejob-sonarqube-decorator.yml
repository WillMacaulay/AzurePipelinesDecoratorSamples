steps:

- task: PowerShell@2
  displayName: 'Set SonarQube values from repository file'
  inputs:
    targetType: 'inline'
    script: |
      Import-Csv .\sonarQube.csv | ForEach-Object {
        
        $sqConn = $_.connection
        $sqOrg  = $_.organization
        $sqPK   = $_.projectKey
        $sqPN   = $_.projectName
        #echo $sqConn, $sqOrg, $sqPK, $sqPN  
        
        # Set environment variables for use in task to initialize SonarQube
        Write-Host "##vso[task.setvariable variable=sonarConnection]$sqConn"
        Write-Host "##vso[task.setvariable variable=sonarOrganization]$sqOrg" 
        Write-Host "##vso[task.setvariable variable=sonarProjectKey]$sqPK" 
        Write-Host "##vso[task.setvariable variable=sonarProjectName]$sqPN"

      }

- task: SonarCloudPrepare@1
  displayName: 'SonarQube -Init'
  inputs:
    SonarCloud:   $env:sonarConnection
    organization: $env:sonarOrganization
    projectKey:   $env:sonarProjectKey
    projectName:  $env:sonarProjectName