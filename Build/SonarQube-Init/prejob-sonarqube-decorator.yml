steps:
  
- task: PowerShell@2
  displayName: 'Set SonarQube values from repository file'
  inputs:
    targetType: 'inline'
    script: |
      echo 'In task: Set SonarQube values from repository file'
      Import-Csv .\sonarQube.csv | ForEach-Object {
        
        $sqConn = $_.connection
        $sqOrg  = $_.organization
        $sqPK   = $_.projectKey
        $sqPN   = $_.projectName
        echo $sqConn, $sqOrg, $sqPK, $sqPN  
        
        # Set environment variables for use in task to initialize SonarQube
        Write-Host "##vso[task.setvariable variable=sonarConnection]$sqConn"
        Write-Host "##vso[task.setvariable variable=sonarOrganization]$sqOrg" 
        Write-Host "##vso[task.setvariable variable=sonarProjectKey]$sqPK" 
        Write-Host "##vso[task.setvariable variable=sonarProjectName]$sqPN"

        Write-Host "##vso[task.setvariable variable=SONARCONNECTION]$sqConn"
        Write-Host "##vso[task.setvariable variable=SONARORGANIZATION]$sqOrg" 
        Write-Host "##vso[task.setvariable variable=SONARPROJECTKEY]$sqPK" 
        Write-Host "##vso[task.setvariable variable=SONARPROJECTNAME]$sqPN"
      }

      
- task: PowerShell@2
  displayName: 'Display sonar csv values'
  inputs:
    targetType: 'inline'
    script: |
      echo 'In task: Display sonar csv values'
      Write-Host "Using connection: $env:sonarConnection"
      Write-Host "Using organization: $env:sonarOrganization"
      Write-Host "Using key: $env:sonarProjectKey"
      Write-Host "Using name: $env:sonarProjectName"

  
- task: PowerShell@2
  displayName: 'PS'
  inputs:
    targetType: 'inline'
    script: |
      echo "##vso[task.setvariable variable=TARGET_FOLDER]$(Pipeline.Workspace)/target"

- task: PowerShell@2
  displayName: 'Target'
  inputs:
    targetType: 'inline'
    script: |
      Write-Host "Using target folder: $TARGET_FOLDER"

#- task: CopyFiles@2
#  inputs:
#    sourceFolder: $(Build.SourcesDirectory)
#    # Note the use of the variable TARGET_FOLDER
#    targetFolder: $(TARGET_FOLDER)/myfolder


- task: SonarCloudPrepare@1
  displayName: 'SonarQube - Initialize'
  inputs:
    SonarCloud:   SonarQube
    organization: willmacaulay
    projectKey:   $(SONARPROJECTNAME)
    projectName:  $(SONARPROJECTNAME)    
    # Hard coded values work - but would be project specific when the extension runs 
    # We want to be able to specify different projects at this point  
